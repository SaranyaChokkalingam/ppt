package com.mycompany.langchain4jexample;

import dev.langchain4j.model.embedding.onnx.allminilml6v2.AllMiniLmL6V2EmbeddingModel;
import dev.langchain4j.model.output.Response;
import dev.langchain4j.data.embedding.Embedding;

import java.io.BufferedWriter;
import java.io.FileWriter;
import java.io.IOException;
import java.util.Arrays;

public class EmbeddingToCSVExample {

    public static void main(String[] args) {
        // Step 1: Create model
        AllMiniLmL6V2EmbeddingModel model = new AllMiniLmL6V2EmbeddingModel();

        // Step 2: Example texts
        String[] texts = {
                "AI is changing the world.",
                "LangChain4j helps use AI in Java.",
                "Chroma is a local vector database."
        };

        // Step 3: Create CSV file
        String outputPath = "embeddings_output.csv";

        try (BufferedWriter writer = new BufferedWriter(new FileWriter(outputPath))) {
            // Write header
            writer.write("text,embedding");
            writer.newLine();

            // Step 4: Process each text
            for (String text : texts) {
                // Generate embedding
                Response<Embedding> response = model.embed(text);
                float[] embedding = response.content().vector();

                // Convert embedding array to string
                String embeddingString = Arrays.toString(embedding);

                // Write line to CSV
                writer.write("\"" + text.replace("\"", "\"\"") + "\"," + embeddingString);
                writer.newLine();
            }

            System.out.println("âœ… Embeddings saved to: " + outputPath);

        } catch (IOException e) {
            e.printStackTrace();
        }
    }
}
