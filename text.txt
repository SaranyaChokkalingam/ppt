import csv
import ast
import chromadb

def load_embeddings_from_csv(csv_path):
    texts = []
    embeddings = []

    with open(csv_path, 'r', encoding='utf-8') as f:
        reader = csv.reader(f)
        next(reader)  # skip header

        for row in reader:
            text = row[0]
            embedding_str = row[1]
            # Convert string "[0.23, -0.56, ...]" to list of floats
            embedding = ast.literal_eval(embedding_str)
            texts.append(text)
            embeddings.append(embedding)

    return texts, embeddings

def main():
    csv_file = "embeddings_output.csv"

    # Load data
    texts, embeddings = load_embeddings_from_csv(csv_file)

    # Initialize chroma client
    client = chromadb.Client()
    collection = client.get_or_create_collection("my_java_embeddings")

    # Add to collection
    for i in range(len(texts)):
        collection.add(
            documents=[texts[i]],
            embeddings=[embeddings[i]],
            ids=[f"id_{i}"]
        )

    print(f"âœ… Loaded {len(texts)} records into Chroma DB collection 'my_java_embeddings'.")

if __name__ == "__main__":
    main()
